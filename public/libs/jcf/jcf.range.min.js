/*!
 * JavaScript Custom Forms : Range Module
 *
 * Copyright 2014-2015 PSD2HTML - http://psd2html.com/jcf
 * Released under the MIT license (LICENSE.txt)
 *
 * Version: 1.2.3
 */
;!function(a){a.addModule(function(b){return{name:"Range",selector:'input[type="range"]',options:{realElementClass:"jcf-real-element",fakeStructure:'<span class="jcf-range"><span class="jcf-range-wrapper"><span class="jcf-range-track"><span class="jcf-range-handle"></span></span></span></span>',dataListMark:'<span class="jcf-range-mark"></span>',rangeDisplayWrapper:'<span class="jcf-range-display-wrapper"></span>',rangeDisplay:'<span class="jcf-range-display"></span>',handleSelector:".jcf-range-handle",trackSelector:".jcf-range-track",activeHandleClass:"jcf-active-handle",verticalClass:"jcf-vertical",orientation:"horizontal",range:!1,dragHandleCenter:!0,snapToMarks:!0,snapRadius:5,minRange:0},matchElement:function(c){return c.is(this.selector)},init:function(){this.initStructure(),this.attachEvents(),this.refresh()},initStructure:function(){for(this.page=b("html"),this.realElement=b(this.options.element).addClass(this.options.hiddenClass),this.fakeElement=b(this.options.fakeStructure).insertBefore(this.realElement).prepend(this.realElement),this.track=this.fakeElement.find(this.options.trackSelector),this.trackHolder=this.track.parent(),this.handle=this.fakeElement.find(this.options.handleSelector),this.createdHandleCount=0,this.activeDragHandleIndex=0,this.isMultiple=this.realElement.prop("multiple")||"string"==typeof this.realElement.attr("multiple"),this.values=this.isMultiple?this.realElement.attr("value").split(","):[this.realElement.val()],this.handleCount=this.isMultiple?this.values.length:1,this.rangeDisplayWrapper=b(this.options.rangeDisplayWrapper).insertBefore(this.track),"min"!==this.options.range&&"all"!==this.options.range||(this.rangeMin=b(this.options.rangeDisplay).addClass("jcf-range-min").prependTo(this.rangeDisplayWrapper)),"max"!==this.options.range&&"all"!==this.options.range||(this.rangeMax=b(this.options.rangeDisplay).addClass("jcf-range-max").prependTo(this.rangeDisplayWrapper));this.createdHandleCount<this.handleCount;){this.createdHandleCount++,this.handle.clone().addClass("jcf-index-"+this.createdHandleCount).insertBefore(this.handle),this.createdHandleCount>1&&(this.rangeMid||(this.rangeMid=b()),this.rangeMid=this.rangeMid.add(b(this.options.rangeDisplay).addClass("jcf-range-mid").prependTo(this.rangeDisplayWrapper)))}this.handle.detach(),this.handle=null,this.handles=this.fakeElement.find(this.options.handleSelector),this.handles.eq(0).addClass(this.options.activeHandleClass),this.isVertical="vertical"===this.options.orientation,this.directionProperty=this.isVertical?"top":"left",this.offsetProperty=this.isVertical?"bottom":"left",this.eventProperty=this.isVertical?"pageY":"pageX",this.sizeProperty=this.isVertical?"height":"width",this.sizeMethod=this.isVertical?"innerHeight":"innerWidth",this.fakeElement.css("touchAction",this.isVertical?"pan-x":"pan-y"),this.isVertical&&this.fakeElement.addClass(this.options.verticalClass),this.minValue=parseFloat(this.realElement.attr("min")),this.maxValue=parseFloat(this.realElement.attr("max")),this.stepValue=parseFloat(this.realElement.attr("step"))||1,this.minValue=isNaN(this.minValue)?0:this.minValue,this.maxValue=isNaN(this.maxValue)?100:this.maxValue,1!==this.stepValue&&(this.maxValue-=(this.maxValue-this.minValue)%this.stepValue),this.stepsCount=(this.maxValue-this.minValue)/this.stepValue,this.createDataList()},attachEvents:function(){this.realElement.on({focus:this.onFocus}),this.trackHolder.on("jcf-pointerdown",this.onTrackPress),this.handles.on("jcf-pointerdown",this.onHandlePress)},createDataList:function(){var d=this,e=[],c=this.realElement.attr("list");c&&(b("#"+c).find("option").each(function(){var f,g,h=parseFloat(this.value||this.innerHTML);isNaN(h)||(g=d.valueToOffset(h),e.push({value:h,offset:g}),f=b(d.options.dataListMark).text(h).attr({"data-mark-value":h}).css(d.offsetProperty,g+"%").appendTo(d.track))}),e.length&&(d.dataValues=e))},getDragHandleRange:function(f){var c=-(1/0),d=1/0;return f>0&&(c=this.valueToStepIndex(parseFloat(this.values[f-1])+this.options.minRange)),f<this.handleCount-1&&(d=this.valueToStepIndex(parseFloat(this.values[f+1])-this.options.minRange)),{minStepIndex:c,maxStepIndex:d}},getNearestHandle:function(e){this.isVertical&&(e=1-e);var f=this.handles.eq(0),c=1/0,d=this;return this.handleCount>1&&this.handles.each(function(){var h=parseFloat(this.style[d.offsetProperty])/100,g=Math.abs(h-e);c>g&&(c=g,f=b(this))}),f},onTrackPress:function(g){var d,f,c;g.preventDefault(),this.realElement.is(":disabled")||this.activeDragHandle||(d=this.track[this.sizeMethod](),f=this.track.offset()[this.directionProperty],this.activeDragHandle=this.getNearestHandle((g[this.eventProperty]-f)/this.trackHolder[this.sizeMethod]()),this.activeDragHandleIndex=this.handles.index(this.activeDragHandle),this.handles.removeClass(this.options.activeHandleClass).eq(this.activeDragHandleIndex).addClass(this.options.activeHandleClass),c=this.activeDragHandle[this.sizeMethod]()/2,this.dragData={trackSize:d,innerOffset:c,trackOffset:f,min:f,max:f+d},this.page.on({"jcf-pointermove":this.onHandleMove,"jcf-pointerup":this.onHandleRelease}),"mouse"===g.pointerType&&this.realElement.focus(),this.onHandleMove(g))},onHandlePress:function(e){var f,c,d;e.preventDefault(),this.realElement.is(":disabled")||this.activeDragHandle||(this.activeDragHandle=b(e.currentTarget),this.activeDragHandleIndex=this.handles.index(this.activeDragHandle),this.handles.removeClass(this.options.activeHandleClass).eq(this.activeDragHandleIndex).addClass(this.options.activeHandleClass),f=this.track[this.sizeMethod](),c=this.track.offset()[this.directionProperty],d=this.options.dragHandleCenter?this.activeDragHandle[this.sizeMethod]()/2:e[this.eventProperty]-this.handle.offset()[this.directionProperty],this.dragData={trackSize:f,innerOffset:d,trackOffset:c,min:c,max:c+f},this.page.on({"jcf-pointermove":this.onHandleMove,"jcf-pointerup":this.onHandleRelease}),"mouse"===e.pointerType&&this.realElement.focus())},onHandleMove:function(f){var j,d,e,m,k,g=this;if(j=this.isVertical?this.dragData.max+(this.dragData.min-f[this.eventProperty])-this.dragData.innerOffset:f[this.eventProperty]-this.dragData.innerOffset,j<this.dragData.min?j=this.dragData.min:j>this.dragData.max&&(j=this.dragData.max),f.preventDefault(),this.options.snapToMarks&&this.dataValues){var c=j-this.dragData.trackOffset;d=(j-this.dragData.trackOffset)/this.dragData.trackSize*100,b.each(this.dataValues,function(p,l){var o=l.offset/100*g.dragData.trackSize,h=o-g.options.snapRadius,q=o+g.options.snapRadius;return c>=h&&q>=c?(d=l.offset,!1):void 0})}else{d=(j-this.dragData.trackOffset)/this.dragData.trackSize*100}e=Math.round(d*this.stepsCount/100),this.handleCount>1&&(k=this.getDragHandleRange(this.activeDragHandleIndex),e<k.minStepIndex?e=Math.max(k.minStepIndex,e):e>k.maxStepIndex&&(e=Math.min(k.maxStepIndex,e))),m=e*(100/this.stepsCount),this.dragData.stepIndex!==e&&(this.dragData.stepIndex=e,this.dragData.offset=m,this.activeDragHandle.css(this.offsetProperty,this.dragData.offset+"%"),this.values[this.activeDragHandleIndex]=""+this.stepIndexToValue(e),this.updateValues(),this.realElement.trigger("input"))},onHandleRelease:function(){var c;"number"==typeof this.dragData.offset&&(c=this.stepIndexToValue(this.dragData.stepIndex),this.realElement.val(c).trigger("change")),this.page.off({"jcf-pointermove":this.onHandleMove,"jcf-pointerup":this.onHandleRelease}),delete this.activeDragHandle,delete this.dragData},onFocus:function(){this.fakeElement.hasClass(this.options.focusClass)||(this.fakeElement.addClass(this.options.focusClass),this.realElement.on({blur:this.onBlur,keydown:this.onKeyPress}))},onBlur:function(){this.fakeElement.removeClass(this.options.focusClass),this.realElement.off({blur:this.onBlur,keydown:this.onKeyPress})},onKeyPress:function(f){var c=38===f.which||39===f.which,d=37===f.which||40===f.which;if(9===f.which&&this.handleCount>1){if(f.shiftKey&&this.activeDragHandleIndex>0){this.activeDragHandleIndex--}else{if(f.shiftKey||!(this.activeDragHandleIndex<this.handleCount-1)){return}this.activeDragHandleIndex++}f.preventDefault(),this.handles.removeClass(this.options.activeHandleClass).eq(this.activeDragHandleIndex).addClass(this.options.activeHandleClass)}(d||c)&&(f.preventDefault(),this.step(c?this.stepValue:-this.stepValue))},updateValues:function(){var c=this.values.join(",");this.values.length>1?(this.realElement.prop("valueLow",this.values[0]),this.realElement.prop("valueHigh",this.values[this.values.length-1]),this.realElement.val(c),this.realElement.val()!==c&&this.realElement.val(this.values[this.values.length-1])):this.realElement.val(c),this.updateRanges()},updateRanges:function(){var d,c=this;this.rangeMin&&(d=this.handles[0],this.rangeMin.css(this.offsetProperty,0).css(this.sizeProperty,d.style[this.offsetProperty])),this.rangeMax&&(d=this.handles[this.handles.length-1],this.rangeMax.css(this.offsetProperty,d.style[this.offsetProperty]).css(this.sizeProperty,100-parseFloat(d.style[this.offsetProperty])+"%")),this.rangeMid&&this.handles.each(function(j,h){var f,g;j>0&&(f=c.handles[j-1],g=c.rangeMid[j-1],g.style[c.offsetProperty]=f.style[c.offsetProperty],g.style[c.sizeProperty]=parseFloat(h.style[c.offsetProperty])-parseFloat(f.style[c.offsetProperty])+"%")})},step:function(h){var f=parseFloat(this.values[this.activeDragHandleIndex||0]),g=f,c=this.minValue,d=this.maxValue;isNaN(f)&&(g=0),g+=h,this.handleCount>1&&(this.activeDragHandleIndex>0&&(c=parseFloat(this.values[this.activeDragHandleIndex-1])+this.options.minRange),this.activeDragHandleIndex<this.handleCount-1&&(d=parseFloat(this.values[this.activeDragHandleIndex+1])-this.options.minRange)),g>d?g=d:c>g&&(g=c),g!==f&&(this.values[this.activeDragHandleIndex||0]=""+g,this.updateValues(),this.realElement.trigger("input").trigger("change"),this.setSliderValue(this.values))},valueToStepIndex:function(c){return(c-this.minValue)/this.stepValue},stepIndexToValue:function(c){return this.minValue+this.stepValue*c},valueToOffset:function(f){var c=this.maxValue-this.minValue,d=(f-this.minValue)/c;return 100*d},getSliderValue:function(){return b.map(this.values,function(c){return parseFloat(c)||0})},setSliderValue:function(d){var c=this;this.handles.each(function(f,e){e.style[c.offsetProperty]=c.valueToOffset(d[f])+"%"})},refresh:function(){var c=this.realElement.is(":disabled");this.fakeElement.toggleClass(this.options.disabledClass,c),this.setSliderValue(this.getSliderValue()),this.updateRanges()},destroy:function(){this.realElement.removeClass(this.options.hiddenClass).insertBefore(this.fakeElement),this.fakeElement.remove(),this.realElement.off({keydown:this.onKeyPress,focus:this.onFocus,blur:this.onBlur})}}})}(jcf);