/*!
 * JavaScript Custom Forms : Select Module
 *
 * Copyright 2014-2015 PSD2HTML - http://psd2html.com/jcf
 * Released under the MIT license (LICENSE.txt)
 *
 * Version: 1.2.3
 */
;!function(a){a.addModule(function(d,f){function c(h){this.options=d.extend({wrapNative:!0,wrapNativeOnMobile:!0,fakeDropInBody:!0,useCustomScroll:!0,flipDropToFit:!0,maxVisibleItems:10,fakeAreaStructure:'<span class="jcf-select"><span class="jcf-select-text"></span><span class="jcf-select-opener"></span></span>',fakeDropStructure:'<div class="jcf-select-drop"><div class="jcf-select-drop-content"></div></div>',optionClassPrefix:"jcf-option-",selectClassPrefix:"jcf-select-",dropContentSelector:".jcf-select-drop-content",selectTextSelector:".jcf-select-text",dropActiveClass:"jcf-drop-active",flipDropClass:"jcf-drop-flipped"},h),this.init()}function j(h){this.options=d.extend({wrapNative:!0,useCustomScroll:!0,fakeStructure:'<span class="jcf-list-box"><span class="jcf-list-wrapper"></span></span>',selectClassPrefix:"jcf-select-",listHolder:".jcf-list-wrapper"},h),this.init()}function k(h){this.options=d.extend({holder:null,maxVisibleItems:10,selectOnClick:!0,useHoverClass:!1,useCustomScroll:!1,handleResize:!0,multipleSelectWithoutKey:!1,alwaysPreventMouseWheel:!1,indexAttribute:"data-index",cloneClassPrefix:"jcf-option-",containerStructure:'<span class="jcf-list"><span class="jcf-list-content"></span></span>',containerSelector:".jcf-list-content",captionClass:"jcf-optgroup-caption",disabledClass:"jcf-disabled",optionClass:"jcf-option",groupClass:"jcf-optgroup",hoverClass:"jcf-hover",selectedClass:"jcf-selected",scrollClass:"jcf-scroll-active"},h),this.init()}var b={name:"Select",selector:"select",options:{element:null,multipleCompactStyle:!1},plugins:{ListBox:j,ComboBox:c,SelectList:k},matchElement:function(h){return h.is("select")},init:function(){this.element=d(this.options.element),this.createInstance()},isListBox:function(){return this.element.is("[size]:not([jcf-size]), [multiple]")},createInstance:function(){this.instance&&this.instance.destroy(),this.isListBox()&&!this.options.multipleCompactStyle?this.instance=new j(this.options):this.instance=new c(this.options)},refresh:function(){var h=this.isListBox()&&this.instance instanceof c||!this.isListBox()&&this.instance instanceof j;h?this.createInstance():this.instance.refresh()},destroy:function(){this.instance.destroy()}};d.extend(c.prototype,{init:function(){this.initStructure(),this.bindHandlers(),this.attachEvents(),this.refresh()},initStructure:function(){this.win=d(f),this.doc=d(document),this.realElement=d(this.options.element),this.fakeElement=d(this.options.fakeAreaStructure).insertAfter(this.realElement),this.selectTextContainer=this.fakeElement.find(this.options.selectTextSelector),this.selectText=d("<span></span>").appendTo(this.selectTextContainer),e(this.fakeElement),this.fakeElement.addClass(g(this.realElement.prop("className"),this.options.selectClassPrefix)),this.realElement.prop("multiple")&&this.fakeElement.addClass("jcf-compact-multiple"),this.options.isMobileDevice&&this.options.wrapNativeOnMobile&&!this.options.wrapNative&&(this.options.wrapNative=!0),this.options.wrapNative?this.realElement.prependTo(this.fakeElement).css({position:"absolute",height:"100%",width:"100%"}).addClass(this.options.resetAppearanceClass):(this.realElement.addClass(this.options.hiddenClass),this.fakeElement.attr("title",this.realElement.attr("title")),this.fakeDropTarget=this.options.fakeDropInBody?d("body"):this.fakeElement)},attachEvents:function(){var h=this;this.delayedRefresh=function(){setTimeout(function(){h.refresh(),h.list&&(h.list.refresh(),h.list.scrollToActiveOption())},1)},this.options.wrapNative?this.realElement.on({focus:this.onFocus,change:this.onChange,click:this.onChange,keydown:this.delayedRefresh}):(this.realElement.on({focus:this.onFocus,change:this.onChange,keydown:this.onKeyDown}),this.fakeElement.on({"jcf-pointerdown":this.onSelectAreaPress}))},onKeyDown:function(h){13===h.which?this.toggleDropdown():this.dropActive&&this.delayedRefresh()},onChange:function(){this.refresh()},onFocus:function(){this.pressedFlag&&this.focusedFlag||(this.fakeElement.addClass(this.options.focusClass),this.realElement.on("blur",this.onBlur),this.toggleListMode(!0),this.focusedFlag=!0)},onBlur:function(){this.pressedFlag||(this.fakeElement.removeClass(this.options.focusClass),this.realElement.off("blur",this.onBlur),this.toggleListMode(!1),this.focusedFlag=!1)},onResize:function(){this.dropActive&&this.hideDropdown()},onSelectDropPress:function(){this.pressedFlag=!0},onSelectDropRelease:function(i,h){this.pressedFlag=!1,"mouse"===h.pointerType&&this.realElement.focus()},onSelectAreaPress:function(i){var h=!this.options.fakeDropInBody&&d(i.target).closest(this.dropdown).length;h||i.button>1||this.realElement.is(":disabled")||(this.selectOpenedByEvent=i.pointerType,this.toggleDropdown(),this.focusedFlag||("mouse"===i.pointerType?this.realElement.focus():this.onFocus(i)),this.pressedFlag=!0,this.fakeElement.addClass(this.options.pressedClass),this.doc.on("jcf-pointerup",this.onSelectAreaRelease))},onSelectAreaRelease:function(h){this.focusedFlag&&"mouse"===h.pointerType&&this.realElement.focus(),this.pressedFlag=!1,this.fakeElement.removeClass(this.options.pressedClass),this.doc.off("jcf-pointerup",this.onSelectAreaRelease)},onOutsideClick:function(m){var l=d(m.target),h=l.closest(this.fakeElement).length||l.closest(this.dropdown).length;h||this.hideDropdown()},onSelect:function(){this.refresh(),this.realElement.prop("multiple")?this.repositionDropdown():this.hideDropdown(),this.fireNativeEvent(this.realElement,"change")},toggleListMode:function(h){this.options.wrapNative||(h?this.realElement.attr({size:4,"jcf-size":""}):this.options.wrapNative||this.realElement.removeAttr("size jcf-size"))},createDropdown:function(){this.dropdown&&(this.list.destroy(),this.dropdown.remove()),this.dropdown=d(this.options.fakeDropStructure).appendTo(this.fakeDropTarget),this.dropdown.addClass(g(this.realElement.prop("className"),this.options.selectClassPrefix)),e(this.dropdown),this.realElement.prop("multiple")&&this.dropdown.addClass("jcf-compact-multiple"),this.options.fakeDropInBody&&this.dropdown.css({position:"absolute",top:-9999}),this.list=new k({useHoverClass:!0,handleResize:!1,alwaysPreventMouseWheel:!0,maxVisibleItems:this.options.maxVisibleItems,useCustomScroll:this.options.useCustomScroll,holder:this.dropdown.find(this.options.dropContentSelector),multipleSelectWithoutKey:this.realElement.prop("multiple"),element:this.realElement}),d(this.list).on({select:this.onSelect,press:this.onSelectDropPress,release:this.onSelectDropRelease})},repositionDropdown:function(){var x,A,B,v=this.fakeElement.offset(),p=this.fakeElement[0].getBoundingClientRect(),q=p.width||p.right-p.left,u=this.fakeElement.outerHeight(),m=this.dropdown.css("width",q).outerHeight(),w=this.win.scrollTop(),z=this.win.height(),y=!1;v.top+u+m>w+z&&v.top-m>w&&(y=!0),this.options.fakeDropInBody&&(B="static"!==this.fakeDropTarget.css("position")?this.fakeDropTarget.offset().top:0,this.options.flipDropToFit&&y?(A=v.left,x=v.top-m-B):(A=v.left,x=v.top+u-B),this.dropdown.css({width:q,left:A,top:x})),this.dropdown.add(this.fakeElement).toggleClass(this.options.flipDropClass,this.options.flipDropToFit&&y)},showDropdown:function(){this.realElement.prop("options").length&&(this.dropdown||this.createDropdown(),this.dropActive=!0,this.dropdown.appendTo(this.fakeDropTarget),this.fakeElement.addClass(this.options.dropActiveClass),this.refreshSelectedText(),this.repositionDropdown(),this.list.setScrollTop(this.savedScrollTop),this.list.refresh(),this.win.on("resize",this.onResize),this.doc.on("jcf-pointerdown",this.onOutsideClick))},hideDropdown:function(){this.dropdown&&(this.savedScrollTop=this.list.getScrollTop(),this.fakeElement.removeClass(this.options.dropActiveClass+" "+this.options.flipDropClass),this.dropdown.removeClass(this.options.flipDropClass).detach(),this.doc.off("jcf-pointerdown",this.onOutsideClick),this.win.off("resize",this.onResize),this.dropActive=!1,"touch"===this.selectOpenedByEvent&&this.onBlur())},toggleDropdown:function(){this.dropActive?this.hideDropdown():this.showDropdown()},refreshSelectedText:function(){var q,p=this.realElement.prop("selectedIndex"),m=this.realElement.prop("options")[p],r=m?m.getAttribute("data-image"):null,t="",h=this;this.realElement.prop("multiple")?(d.each(this.realElement.prop("options"),function(l,i){i.selected&&(t+=(t?", ":"")+i.innerHTML)}),t||(t=h.realElement.attr("placeholder")||""),this.selectText.removeAttr("class").html(t)):m?this.currentSelectedText===m.innerHTML&&this.currentSelectedImage===r||(q=g(m.className,this.options.optionClassPrefix),this.selectText.attr("class",q).html(m.innerHTML),r?(this.selectImage||(this.selectImage=d("<img>").prependTo(this.selectTextContainer).hide()),this.selectImage.attr("src",r).show()):this.selectImage&&this.selectImage.hide(),this.currentSelectedText=m.innerHTML,this.currentSelectedImage=r):(this.selectImage&&this.selectImage.hide(),this.selectText.removeAttr("class").empty())},refresh:function(){"none"===this.realElement.prop("style").display?this.fakeElement.hide():this.fakeElement.show(),this.refreshSelectedText(),this.fakeElement.toggleClass(this.options.disabledClass,this.realElement.is(":disabled"))},destroy:function(){this.options.wrapNative?this.realElement.insertBefore(this.fakeElement).css({position:"",height:"",width:""}).removeClass(this.options.resetAppearanceClass):(this.realElement.removeClass(this.options.hiddenClass),this.realElement.is("[jcf-size]")&&this.realElement.removeAttr("size jcf-size")),this.fakeElement.remove(),this.doc.off("jcf-pointerup",this.onSelectAreaRelease),this.realElement.off({focus:this.onFocus})}}),d.extend(j.prototype,{init:function(){this.bindHandlers(),this.initStructure(),this.attachEvents()},initStructure:function(){this.realElement=d(this.options.element),this.fakeElement=d(this.options.fakeStructure).insertAfter(this.realElement),this.listHolder=this.fakeElement.find(this.options.listHolder),e(this.fakeElement),this.fakeElement.addClass(g(this.realElement.prop("className"),this.options.selectClassPrefix)),this.realElement.addClass(this.options.hiddenClass),this.list=new k({useCustomScroll:this.options.useCustomScroll,holder:this.listHolder,selectOnClick:!1,element:this.realElement})},attachEvents:function(){var h=this;this.delayedRefresh=function(i){i&&(16===i.which||i.ctrlKey||i.metaKey||i.altKey)||(clearTimeout(h.refreshTimer),h.refreshTimer=setTimeout(function(){h.refresh(),h.list.scrollToActiveOption()},1))},this.realElement.on({focus:this.onFocus,click:this.delayedRefresh,keydown:this.delayedRefresh}),d(this.list).on({select:this.onSelect,press:this.onFakeOptionsPress,release:this.onFakeOptionsRelease})},onFakeOptionsPress:function(i,h){this.pressedFlag=!0,"mouse"===h.pointerType&&this.realElement.focus()},onFakeOptionsRelease:function(i,h){this.pressedFlag=!1,"mouse"===h.pointerType&&this.realElement.focus()},onSelect:function(){this.fireNativeEvent(this.realElement,"change"),this.fireNativeEvent(this.realElement,"click")},onFocus:function(){this.pressedFlag&&this.focusedFlag||(this.fakeElement.addClass(this.options.focusClass),this.realElement.on("blur",this.onBlur),this.focusedFlag=!0)},onBlur:function(){this.pressedFlag||(this.fakeElement.removeClass(this.options.focusClass),this.realElement.off("blur",this.onBlur),this.focusedFlag=!1)},refresh:function(){this.fakeElement.toggleClass(this.options.disabledClass,this.realElement.is(":disabled")),this.list.refresh()},destroy:function(){this.list.destroy(),this.realElement.insertBefore(this.fakeElement).removeClass(this.options.hiddenClass),this.fakeElement.remove()}}),d.extend(k.prototype,{init:function(){this.initStructure(),this.refreshSelectedClass(),this.attachEvents()},initStructure:function(){this.element=d(this.options.element),this.indexSelector="["+this.options.indexAttribute+"]",this.container=d(this.options.containerStructure).appendTo(this.options.holder),this.listHolder=this.container.find(this.options.containerSelector),this.lastClickedIndex=this.element.prop("selectedIndex"),this.rebuildList(),this.element.prop("multiple")&&(this.previousSelection=this.getSelectedOptionsIndexes())},attachEvents:function(){this.bindHandlers(),this.listHolder.on("jcf-pointerdown",this.indexSelector,this.onItemPress),this.listHolder.on("jcf-pointerdown",this.onPress),this.options.useHoverClass&&this.listHolder.on("jcf-pointerover",this.indexSelector,this.onHoverItem)},onPress:function(h){d(this).trigger("press",h),this.listHolder.on("jcf-pointerup",this.onRelease)},onRelease:function(h){d(this).trigger("release",h),this.listHolder.off("jcf-pointerup",this.onRelease)},onHoverItem:function(i){var h=parseFloat(i.currentTarget.getAttribute(this.options.indexAttribute));this.fakeOptions.removeClass(this.options.hoverClass).eq(h).addClass(this.options.hoverClass)},onItemPress:function(h){"touch"===h.pointerType||this.options.selectOnClick?(this.tmpListOffsetTop=this.list.offset().top,this.listHolder.on("jcf-pointerup",this.indexSelector,this.onItemRelease)):this.onSelectItem(h)},onItemRelease:function(h){this.listHolder.off("jcf-pointerup",this.indexSelector,this.onItemRelease),this.tmpListOffsetTop===this.list.offset().top&&this.listHolder.on("click",this.indexSelector,{savedPointerType:h.pointerType},this.onSelectItem),delete this.tmpListOffsetTop},onSelectItem:function(m){var l,h=parseFloat(m.currentTarget.getAttribute(this.options.indexAttribute)),n=m.data&&m.data.savedPointerType||m.pointerType||"mouse";this.listHolder.off("click",this.indexSelector,this.onSelectItem),m.button>1||this.realOptions[h].disabled||(this.element.prop("multiple")?m.metaKey||m.ctrlKey||"touch"===n||this.options.multipleSelectWithoutKey?this.realOptions[h].selected=!this.realOptions[h].selected:m.shiftKey?(l=[this.lastClickedIndex,h].sort(function(o,i){return o-i}),this.realOptions.each(function(o,i){i.selected=o>=l[0]&&o<=l[1]})):this.element.prop("selectedIndex",h):this.element.prop("selectedIndex",h),m.shiftKey||(this.lastClickedIndex=h),this.refreshSelectedClass(),"mouse"===n&&this.scrollToActiveOption(),d(this).trigger("select"))},rebuildList:function(){var p=this,m=this.element[0];this.storedSelectHTML=m.innerHTML,this.optionIndex=0,this.list=d(this.createOptionsList(m)),this.listHolder.empty().append(this.list),this.realOptions=this.element.find("option"),this.fakeOptions=this.list.find(this.indexSelector),this.fakeListItems=this.list.find("."+this.options.captionClass+","+this.indexSelector),delete this.optionIndex;var q=this.options.maxVisibleItems,r=this.element.prop("size");r>1&&!this.element.is("[jcf-size]")&&(q=r);var h=this.fakeOptions.length>q;return this.container.toggleClass(this.options.scrollClass,h),h&&(this.listHolder.css({maxHeight:this.getOverflowHeight(q),overflow:"auto"}),this.options.useCustomScroll&&a.modules.Scrollable)?void a.replace(this.listHolder,"Scrollable",{handleResize:this.options.handleResize,alwaysPreventMouseWheel:this.options.alwaysPreventMouseWheel}):void (this.options.alwaysPreventMouseWheel&&(this.preventWheelHandler=function(o){var n=p.listHolder.scrollTop(),l=p.listHolder.prop("scrollHeight")-p.listHolder.innerHeight();(0>=n&&o.deltaY<0||n>=l&&o.deltaY>0)&&o.preventDefault()},this.listHolder.on("jcf-mousewheel",this.preventWheelHandler)))},refreshSelectedClass:function(){var n,l=this,m=this.element.prop("multiple"),h=this.element.prop("selectedIndex");m?this.realOptions.each(function(o,i){l.fakeOptions.eq(o).toggleClass(l.options.selectedClass,!!i.selected)}):(this.fakeOptions.removeClass(this.options.selectedClass+" "+this.options.hoverClass),n=this.fakeOptions.eq(h).addClass(this.options.selectedClass),this.options.useHoverClass&&n.addClass(this.options.hoverClass))},scrollToActiveOption:function(){var h=this.getActiveOptionOffset();"number"==typeof h&&this.listHolder.prop("scrollTop",h)},getSelectedOptionsIndexes:function(){var h=[];return this.realOptions.each(function(i,l){l.selected&&h.push(i)}),h},getChangedSelectedIndex:function(){var m=this.element.prop("selectedIndex"),l=this,h=!1,n=null;return this.element.prop("multiple")?(this.currentSelection=this.getSelectedOptionsIndexes(),d.each(this.currentSelection,function(o,i){!h&&l.previousSelection.indexOf(i)<0&&(0===o&&(h=!0),n=i)}),this.previousSelection=this.currentSelection,n):m},getActiveOptionOffset:function(){var p=this.getChangedSelectedIndex();if(null!==p){var l=this.listHolder.height(),m=this.listHolder.prop("scrollTop"),h=this.fakeOptions.eq(p),q=h.offset().top-this.list.offset().top,r=h.innerHeight();return q+r>=m+l?q-l+r:m>q?q:void 0}},getOverflowHeight:function(n){var l=this.fakeListItems.eq(n-1),m=this.list.offset().top,h=l.offset().top,p=l.innerHeight();return h+p-m},getScrollTop:function(){return this.listHolder.scrollTop()},setScrollTop:function(h){this.listHolder.scrollTop(h)},createOption:function(n){var l=document.createElement("span");l.className=this.options.optionClass,l.innerHTML=n.innerHTML,l.setAttribute(this.options.indexAttribute,this.optionIndex++);var m,h=n.getAttribute("data-image");return h&&(m=document.createElement("img"),m.src=h,l.insertBefore(m,l.childNodes[0])),n.disabled&&(l.className+=" "+this.options.disabledClass),n.className&&(l.className+=" "+g(n.className,this.options.cloneClassPrefix)),l},createOptGroup:function(n){var l,m,h=document.createElement("span"),p=n.getAttribute("label");return l=document.createElement("span"),l.className=this.options.captionClass,l.innerHTML=p,h.appendChild(l),n.children.length&&(m=this.createOptionsList(n),h.appendChild(m)),h.className=this.options.groupClass,h},createOptionContainer:function(){var h=document.createElement("li");return h},createOptionsList:function(m){var l=this,h=document.createElement("ul");return d.each(m.children,function(p,i){var q,r=l.createOptionContainer(i);switch(i.tagName.toLowerCase()){case"option":q=l.createOption(i);break;case"optgroup":q=l.createOptGroup(i)}h.appendChild(r).appendChild(q)}),h},refresh:function(){this.storedSelectHTML!==this.element.prop("innerHTML")&&this.rebuildList();var h=a.getInstance(this.listHolder);h&&h.refresh(),this.refreshSelectedClass()},destroy:function(){this.listHolder.off("jcf-mousewheel",this.preventWheelHandler),this.listHolder.off("jcf-pointerdown",this.indexSelector,this.onSelectItem),this.listHolder.off("jcf-pointerover",this.indexSelector,this.onHoverItem),this.listHolder.off("jcf-pointerdown",this.onPress)}});var g=function(i,h){return i?i.replace(/[\s]*([\S]+)+[\s]*/gi,h+"$1 "):""},e=function(){function h(l){l.preventDefault()}var i=a.getOptions().unselectableClass;return function(l){l.addClass(i).on("selectstart",h)}}();return b})}(jcf);